{% extends 'base/widget.html' %}
{% load static %}
{% block title %}Inicio | Bienvenidos ðŸ¦…{% endblock %}
{% block extra_head %}
<link href="https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.css" rel="stylesheet">
<link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.js"></script>
{% endblock %}
{% block last_head %}
<script type="module" src="{% static 'libs/model-viewer.min.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/chatbot.min.css' %}" />
<link rel="stylesheet" href="{% static 'css/mapbox.min.css' %}"/>
{% endblock %}
{% block navbar %}
<!--  -->
{% endblock %}
{% block content %}
<img src="{% static 'img/UTC_logo-plano.webp' %}" alt="Logo UTC" class="img_logo">
<main class="full_screen map_user" id='map' data-mapa_edif="{% url 'mapa_edificios' %}" data-mapa_markers="{% url 'mapa_markers' %}">
    <!-- Controles de ruta -->
    <section class="controls_route card m-2 max_w250 show" id="controlsRoute">
        <div class="card-header d-flex justify-content-between align-items-center p-3">
            <h6 class="m-0"><i class="fa-solid fa-route me-1"></i>Como ir a...</h6>
            <button type="button" class="btn-close" data-btn_closed="#controlsRoute"></button>
        </div>
        <div class="card-body p-3">
            <div>
                <form autocomplete="off" id="form_route">
                    <select id="origen" class="form-control mb-3" title="origen">
                        <option disabled selected hidden>Tu ubicaciÃ³n</option>
                    </select>
                    <select id="destino" class="form-control" title="destino">
                        <option disabled selected hidden>Seleccionar destino</option>
                    </select>
                </form>
                <div id="buttons_route" class="none mt-3">
                    <div class="d-flex gap-3">
                        <button title="Borrar Formulario" type="button" class="btn btn_detail btn-block mt-0 px-1" data-reset_form="form_route">
                            <i class="fa-solid fa-delete-left me-1"></i> Borrar
                        </button>
                        <!-- <button type="button" title="Iniciar ruta" class="btn btn_detail btn-block mt-0 px-1" id="startRoute" data-start-route>
                            Iniciar <i class="fa-solid fa-person-walking ms-1"></i>
                        </button> -->
                    </div>
                </div>
            </div>
        </div>
        <!-- Informacion de la ruta -->
        <div class="card-footer">
            <div id="route-info" class="p-0 m-0 none"></div>
        </div>
    </section>
</main>

<main id="model" class="main_model">
    <model-viewer id="asistent_model" class="mx-auto" autoplay loading="eager" src="{{model_3D}}" shadow-intensity="1" tone-mapping="neutral" camera-orbit="15deg 70deg 5m" animation-name="{{anim_default}}" data-settings-model="{% url 'modelsettings' %}" environment-image="" skybox-image="">
        {% if active_areas %}
        <div id="model_areas" class="model_areas slide_areas show"></div>
        {% endif %}
    </model-viewer>
    <form action="{% url 'chatbot' %}" method="POST" id="chatForm" class="chat_form card">
        {% csrf_token %}
        <textarea name="chatquestion" id="txtQuestion" class="pb-4 mx-3 mt-3" placeholder="Preguntale a Howky: ... " autofocus minlength="4"></textarea>
        <div class="chat_controls p-2 gap_10">
            <button type="submit" id="chatForm_submit" class="btn btn-floating btn_detail pe-1">
                <i class="fa-solid fa-paper-plane"></i>
            </button>
            <button type="button" id="chatMicrophone" class="btn btn-floating btn_detail">
                <i class="fa-solid fa-microphone"></i>
            </button>
            <button type="button" id="chatOpenMap" class="btn btn-floating btn_detail" data-toggle-class="body-open_map">
                <i class="fa-solid fa-map-location-dot"></i>
            </button>
            <button type="button" id="openChat" class="btn btn-floating btn_detail me-auto">
                <i class="fa-solid fa-comments"></i>
            </button>
            <button type="button" id="floatSettings" class="btn btn-floating btn_detail" data-mdb-modal-init data-mdb-target="#configModal">
                <i class="fa-solid fa-gear"></i>
            </button>
        </div>
    </form>
    <div class="chat_output show py-3" id="output"></div>
</main>

<!-- OffCanvas: Informacion del lugar -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="infoLateral" aria-labelledby="infoLateralLabel">
    <div class="offcanvas-header position-relative p-0">
        <button type="button" class="btn-close position-absolute top-0 end-0 p-4 m-1 m-md-2" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        <div class="bg-image">
            <img src="{% static 'img/default_image.webp' %}" id="imagen_actual" class="img-fluid" title="Imagen del lugar"/>
            <div class="mask mask_white">
                <div class="d-flex align-items-end h-100 p-3 pt-0">
                    <h3 class="fw-bold mb-0 lateralTitle"></h3>
                </div>
            </div>
        </div>
    </div>
    <div class="offcanvas-body">
        <div class="rounded" id="offcanvasContent"></div>
        <div class="d-flex flex-column mt-4 gap_10" id="offcanvasGalery"></div>
    </div>
    <div class="offcanvas-footer p-3"></div>
</div>

<!-- OffCanvas: Cambiar estilo -->
<div class="offcanvas offcanvas-bottom" tabindex="-1" id="offcanvasBottom" aria-labelledby="offcanvasBottomLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasBottomLabel">Cambiar Estilo <i class="fa-solid fa-layer-group ms-1"></i></h5>
        <button type="button" class="btn-close m-2 p-3" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body row" id="offcanvasbody">
        <div class="col-4 col-md p-2">
            <label class="card" for="satellite-streets-v12">
                <input id="satellite-streets-v12" type="radio" name="rtoggle" value="satellite" class="none">
                <div class="card-body pb-1 p-3 text-center">
                    <div><i class="fa-solid fa-satellite"></i></div>
                    <div>Satelital</div>
                </div>
            </label>
        </div>
        <div class="col-4 col-md p-2">
            <label class="card btn_detail text-white cursor-not" for="streets-v12">
                <input id="streets-v12" type="radio" name="rtoggle" value="streets" disabled checked class="none">
                <div class="card-body pb-1 p-3 text-center">
                    <div><i class="fa-solid fa-signs-post"></i></div>
                    <div>Caminos</div>
                </div>
            </label>
        </div>
        <div class="col-4 col-md p-2">
            <label class="card" for="outdoors-v12">
                <input id="outdoors-v12" type="radio" name="rtoggle" value="outdoors" class="none">
                <div class="card-body pb-1 p-3 text-center">
                    <div><i class="fa-solid fa-road"></i></div>
                    <div>Calles</div>
                </div>
            </label>
        </div>
        <div class="col-6 col-md p-2">
            <label class="card" for="light-v11">
                <input id="light-v11" type="radio" name="rtoggle" value="light" class="none">
                <div class="card-body pb-1 p-3 text-center">
                    <div><i class="fa-regular fa-map"></i></div>
                    <div>Claro</div>
                </div>
            </label>
        </div>
        <div class="col-6 col-md p-2">
            <label class="card" for="dark-v11">
                <input id="dark-v11" type="radio" name="rtoggle" value="dark" class="none">
                <div class="card-body pb-1 p-3 text-center">
                    <div><i class="fa-solid fa-map"></i></div>
                    <div>Oscuro</div>
                </div>
            </label>
        </div>
    </div>
</div>

<!-- Modal: Abrir Google Maps -->
<div class="modal fade" id="beforeSend" tabindex="-1" aria-labelledby="beforeSendLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="beforeSendLabel">Abrir Google Maps <i class="fa-solid fa-map-location-dot ms-1"></i></h5>
                <button type="button" class="btn-close" data-mdb-ripple-init data-mdb-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h4 class="col-8 col-md-12 mx-auto text-center">Â¿Quieres saber como llegar a la UTC?</h4>
                <p class="p-3">Con esta opcion te enviaremos a <span class="fw-bold style_google">Google</span> Maps, para que puedas ir desde tu ubicacion
                    hasta la UTC
                </p>
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <button type="button" class="btn btn-secondary" data-mdb-ripple-init data-mdb-dismiss="modal">Cancelar</button>
                <a target="_blank" rel="noopener" href="https://www.google.com.mx/maps/dir/25.5565711,-100.936538/Universidad+Tecnol%C3%B3gica+de+Coahuila,+Boulevard+del+Parque+Industrial+Francisco+R.+Alanis,+Zona+Industrial,+Ramos+Arizpe,+Coahuila+de+Zaragoza/@25.5564822,-100.9417562,16z/data=!3m1!4b1!4m10!4m9!1m1!4e1!1m5!1m1!1s0x868814c0002295ff:0x5c622cc711957b03!2m2!1d-100.9368619!2d25.5583972!3e2?entry=ttu" class="btn btn_detail" data-mdb-ripple-init>Abrir <i class="fa-solid fa-up-right-from-square ms-1"></i></a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block moresettings %}
    <div class="text-center mt-4">
        <div class="d-flex justify-content-between align-items-center gap_10">
            <p class="m-0">Microfono Siempre Activo: <strong id="chatListeningText">No</strong></p>
            <div>
                <label class="switch">
                    <input type="checkbox" id="chatListeningAll">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts_end %}
<script src="{% static 'js/settings_chatbot.js' %}"></script>
<script src="{% static 'js/settings_model.js' %}"></script>
<script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="{% static 'js/settings_mapbox.js' %}"></script>
{% endblock %}
