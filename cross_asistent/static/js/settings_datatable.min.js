const dtLenguage={url:"https://cdn.datatables.net/plug-ins/2.1.5/i18n/es-MX.json"},tableDatabaseObj=document.getElementById("datatable_database"),tableBannersObj=document.getElementById("datatableBanners");let tableDatabase,tableBanners,dataTableIsInitialized=!1;const initDataTable=async()=>{if(dataTableIsInitialized&&(tableDatabase.destroy(),tableBanners.destroy()),tableDatabaseObj&&(await listDatabase(),tableDatabase=$("#datatable_database").DataTable({columnDefs:[{className:"text-center",targets:[0,1,2,3,4,5]},{orderable:!1,targets:[3,4,5]},{searchable:!1,targets:[0,3,4,5]}],language:dtLenguage,pageLength:20,destroy:!0})),tableBannersObj){await listBanners(),tableBanners=$("#datatableBanners").DataTable({columnDefs:[{className:"text-center",targets:[0,1,2,3]},{orderable:!1,targets:[2,3]},{searchable:!1,targets:[2,3]}],language:dtLenguage,lengthChange:!1,paging:!1,info:!1,destroy:!0});tableBanners.rows().count()>10&&(tableBanners.page.len(10).draw(),tableBanners.settings()[0].oFeatures.bPaginate=!0,tableBanners.settings()[0].oFeatures.bInfo=!0,tableBanners.settings()[0].oFeatures.bLengthChange=!0)}dataTableIsInitialized=!0},listDatabase=async()=>{try{const t="tbodyDatabase",e=$(`#${t}`).data("list-table");await fetch(e).then(t=>t.ok?t.json():t.json().then(t=>{throw new Error(t.message||"Error desconocido")})).then(e=>{$(`[data-table-load='${t}']`).addClass("d-none"),$(`[data-table-container='${t}']`).removeClass("d-none");let a="";e.infodb.map(t=>{let e="";t.imagen&&(e=`<img src="${t.imagen}" loading="lazy" alt="Imagen: ${t.titulo}" class="img-rounded max_w150">`),a+=`<tr class="table_odd_items"><td>${t.id}</td><td>${t.categoria}</td><td>${t.titulo}</td><td>${e}</td><td>${t.documento}</td><td><div class="d-flex flex-column align-items-center gap_10"><button type="button" class="btn btn-floating btn-info" onclick="openModal('#editDBModal',${t.id})"><i class="fa-solid fa-edit fs-12"></i></button><button type="button" class="btn btn-floating btn-danger" onclick="openModal('#deleteDBmodal',${t.id})"><i class="fa-regular fa-trash-can fs-12"></i></button></div></td></tr>`}),tbodyDatabase.innerHTML=a}).catch(t=>{console.error("ðŸ˜¥ Error:",t),alertSToast("top",8e3,"warning","OcurriÃ³ un error al obtener los datos. ðŸ˜¥")})}catch(t){alert(t),console.error(t)}},listBanners=async()=>{try{const t="tbodyBanners",e=$(`#${t}`).data("list-table"),a=$(`#${t}`).data("url-visible");await fetch(e).then(t=>t.ok?t.json():t.json().then(t=>{throw new Error(t.message||"Error desconocido")})).then(e=>{$(`[data-table-load='${t}']`).addClass("d-none"),$(`[data-table-container='${t}']`).removeClass("d-none");let n="";e.infobanners.map(t=>{let e=t.titulo,i="",o="",s="";0==t.solo_imagen?s=t.descripcion:(e+='<div class="bg-success rounded-pill p-2 py-1 m-2 mb-0 d-inline-block fs-6">Solo Imagen y boton</div>',i='colspan="2"',o='class="d-none"'),t.visible?(s=t.descripcion,visibleInput="False",visibleColor="btn-warning",visibleIcon="fa-eye-slash"):(e+='<div class="bg-danger rounded-pill p-2 py-1 m-2 mb-0 d-inline-block fs-6">Banner Invisible</div>',i='colspan="2"',o='class="d-none"',visibleInput="True",visibleColor="btn_purple",visibleIcon="fa-eye");let d="";t.imagen&&(d=`<img src="${t.imagen}" loading="lazy" class="img-rounded max_w150">`),n+=`<tr id="row-banners_${t.id}" class="table_odd_items"><td ${i}>${e}</td><td ${o}>${s}</td><td>${d}</td><td><div class="d-flex align-items-center gap_10"><form method="post" action="${a}" data-submit-dt><input type="text" name="banner_id" value="${t.id}" class="d-none"><input type="text" name="banner_visible" value="${visibleInput}" class="d-none"><button type="submit" class="btn btn-floating ${visibleColor}"><i class="fa-solid ${visibleIcon} text-white fs-10"></i></button></form><button type="button" class="btn btn-floating btn-info" onclick="openModal('#editBannerModal',${t.id})"><i class="fa-solid fa-edit fs-12"></i></button><button type="button" class="btn btn-floating btn-danger" onclick="openModal('#eliminarBanner',${t.id})"><i class="fa-solid fa-trash fs-12"></i></button></div></td></tr>`}),tbodyBanners.innerHTML=n,$("[data-submit-dt]").submit(jsonSubmit)}).catch(t=>{console.error("ðŸ˜¥ Error:",t),alertSToast("top",8e3,"warning","OcurriÃ³ un error al obtener los Banners. ðŸ˜¥")})}catch(t){alert(t),console.error(t)}};function openModal(t,e){$(t).data("get-info",e),$(t).modal("show")}function fetchData(t,e,a,n,i){$.ajax({url:e,method:"POST",data:JSON.stringify({id:a}),contentType:"application/json; charset=utf-8",dataType:"json",async:!0,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRFToken":formToken},success:i,error:function(t,e,a){console.error("Error:...",e,a),alertSToast("center",9e3,"error",n)}})}if(window.addEventListener("load",async()=>{await initDataTable(),setTimeout(()=>{$("[data-table-container] .row.dt-row ").addClass("table-responsive m-0 my-3"),$("[data-table-container] .row.dt-row .col-sm-12").addClass("p-0")},500)}),tableDatabaseObj){const t=$("#tbodyDatabase").data("url-info");$("#editDBModal").on("show.bs.modal",function(){const e=$(this).data("get-info");fetchData($(this),t,e,"Ocurrio un error al obtener los datos",function(t){const a=$("#editDBModal");a.find("#editid").val(e),a.find("#editcateg").val(t.categoria),a.find("#editcateg").text(t.categoria),a.find("#edittitulo").val(t.titulo),a.find("#editinfo").val(t.informacion),a.find("#tags").val(t.tags).click(),null==t.redirigir&&""==t.redirigir||a.find("#editredirigir").val(t.redirigir)})}),$("#editDBModal").on("hidden.bs.modal",function(){const t=$(this);t.find("input").val(""),t.find("textarea").text("")}),$("#deleteDBmodal").on("show.bs.modal",function(){const e=$(this).data("get-info"),a=$(this);fetchData(a,t,e,"Ocurrio un error al obtener los datos",function(t){a.find("#deltitulo").text(t.titulo),a.find("#delid").val(e)})}),$("#deleteDBmodal").on("hidden.bs.modal",function(){const t=$(this);t.find("#deltitulo").text(""),t.find("#delid").val("")})}if(tableBannersObj){const t=$("#tbodyBanners").data("url-info");$("#editBannerModal").on("show.bs.modal",function(){const e=$(this).data("get-info"),a=$(this);fetchData(a,t,e,"Ocurrio un error al obtener los datos del Banner",function(t){if(t.solo_imagen?a.find("#editsoloImagen").attr("checked","checked"):a.find("#editsoloImagen").removeAttr("checked"),a.find("#banner_id").val(e),a.find("#editDescripcion").text(t.descripcion),a.find("#editRedirigir").val(t.redirigir),null!=t.expiracion||""==t.expiracion){const e=convertToDateInputFormat(t.expiracion);a.find("#editExpiracion").val(e)}tinymce.get("editTitulo").setContent(t.titulo)})}),$("#editBannerModal").on("hidden.bs.modal",function(){const t=$(this);t.find("input").val(""),t.find("textarea").text(""),tinymce.get("editTitulo").setContent("")}),$("#eliminarBanner").on("show.bs.modal",function(){const e=$(this).data("get-info"),a=$(this);fetchData(a,t,e,"Ocurrio un error al obtener los datos del Banner",function(t){a.find("#deletebannername").html(t.titulo),a.find("#deletebannerid").val(e);a.find("button[type='submit']").on("click",function(){let e=$(`#row-banners_${t.id}`);setTimeout(()=>{e.remove()},500)})})}),$("#eliminarBanner").on("hidden.bs.modal",function(){const t=$(this);t.find("#deletebannername").html(""),t.find("input").val("")})}