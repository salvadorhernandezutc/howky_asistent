function chatSubmit(e){e.preventDefault();const t=cadenaRandom(5,alfabetico),o=txtQuestion.value,a=e.target;a.reset();const s=`<div class="chat_msg d-flex justify-content-end user_submit" data-tokeid="uuid${t}"><div class="msg_user p-2 bg_detail">${o}</div></div>`;contOutput.insertAdjacentHTML("beforeend",s);const n=$(`.user_submit[data-tokeid="uuid${t}"]`);setTimeout(()=>{n.removeClass("active").addClass("show"),setTimeout(scrollToBottom,500),setTimeout(()=>{n.addClass("active")},5e3)},20);const i='<div class="chat_msg chat_open my-4" data-tokeid="loadInfoDelete"><div class="msg_response"><div class="mx-auto pulse-container"><div class="pulse-bubble bg_detail"></div><div class="pulse-bubble bg_detail"></div><div class="pulse-bubble bg_detail"></div></div></div></div>';if(contOutput.insertAdjacentHTML("beforeend",i),setTimeout(function(){$('.chat_msg[data-tokeid="loadInfoDelete"]').addClass("show"),setTimeout(scrollToBottom,500)},200),texto3.test(o))fetch(a.action,{method:"POST",body:JSON.stringify({question:o}),headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRFToken":a.querySelector("[name=csrfmiddlewaretoken]").value}}).then(e=>e.ok?e.json():e.json().then(e=>{throw new Error(e.message||"Error desconocido")})).then(e=>{if(e.success)displayResponse(e.answer);else{console.error("😥 Error: ------------------------------"),console.error(e.message),console.error("😥 Error: ------------------------------");const t="Lo siento pero no puedo responder en este momento. <br> La verdad es que hoy me sature de tantas solicitudes y no puedo procesar más. 😥🤒 <br> Estare de nuevo en funcionamineto muy pronto. 😊😉😌";displayText(t)}}).catch(e=>{console.error("😥 Error:",e),alertSToast("top",8e3,"warning","Ocurrió un error. Intente nuevamente. 😥")});else{const e="No comprendo a lo que te refieres, por dame mas detalles de lo que deseas saber <br> Mientras mas detalles mejor 😊😉.";displayText(e)}}function displayResponse(e){const t=cadenaRandom(5,alfabetico),o=e.imagenes,a=e.redirigir;let s="",n="";if(null!=o&&(s=`<div class="chat_msg show"><img src="${o}" alt="${e.titulo}" class="chat_img" /></div>`),a&&""!==a.trim()){const e=a.includes("~"),t=e?'button type="button" data-route':"a href",o=e?"Abrir ruta en el Mapa":"Ver más";n=`\n            <div class="chat_msg show msg_link">\n                <${t}="${a}" class="btn btn_detail_inset">\n                    ${o} <i class="fas fa-up-right-from-square ms-1"></i>\n                </${e?"button":"a"}>\n            </div>\n        `}const i=e.informacion.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/^\s*[\-\*]\s+/gm,"").replace(/`([^`]*)`/g,"$1"),r=`<div class="chat_msg chat_open" data-tokeid="uuid${t}"><div class="msg_response">${i}</div></div>${s} ${n}`;contOutput.insertAdjacentHTML("beforeend",r);const c=document.querySelector(`.chat_msg[data-tokeid="uuid${t}"]`);$('.chat_msg[data-tokeid="loadInfoDelete"]').remove(),setTimeout(function(){c.classList.add("show"),setTimeout(scrollToBottom,350)},20)}function displayText(e){$('.chat_msg[data-tokeid="loadInfoDelete"]').remove();const t=cadenaRandom(5,alfabetico),o=e.replace(/\n/g,"<br>"),a=`<div class="chat_msg chat_open" data-tokeid="uuid${t}"><div class="msg_response">${o}</div></div>`;contOutput.insertAdjacentHTML("beforeend",a);const s=document.querySelector(`.chat_msg[data-tokeid="uuid${t}"]`);setTimeout(function(){s.classList.add("show"),setTimeout(scrollToBottom,350)},20)}function scrollToBottom(){contOutput.scrollTop=contOutput.scrollHeight}var alfabetico="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz12345678901234567890",texto3=/[a-zA-Z0-9]{3}/;const isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);$(document).ready(function(){try{const s=$("#asistent_model");let n=!1;function e(){n=!n,n?s[0].pause():s[0].play()}$("#openChat").on("click",function(){$("#model").toggleClass("open"),e()});const i=s.attr("data-camera-orbit");function t(){const t=i.split(" "),o=t[0].replace("deg",""),a=t[1],n=t[2],r=`${-1*o}deg ${a} ${n}`;setTimeout(()=>{$("body").hasClass("open_map")?($("#chatOpenMap i.fa-solid").addClass("fa-comment-dots").removeClass("fa-map-location-dot"),s.attr("camera-orbit",r)):($("#chatOpenMap i.fa-solid").addClass("fa-map-location-dot").removeClass("fa-comment-dots"),s.attr("camera-orbit",i)),$("#model").hasClass("open")&&e()},500)}$("#chatOpenMap").on("click",t),$(document).on("click","[data-route]",function(){const e=!0===$("body").hasClass("open_map");e||(t(),$("body").addClass("open_map"));const o=$(this).attr("data-route").split("~"),a=new URLSearchParams(window.location.search);a.set("origin",o[0]),a.set("destiny",o[1]),history.replaceState({},"",`${location.pathname}?${a}`)}),$("#txtQuestion").keydown(e=>{13!==e.keyCode||e.shiftKey||(e.preventDefault(),$("#chatForm_submit").click())}),$("#chatForm").submit(chatSubmit);const r=window.SpeechRecognition||window.webkitSpeechRecognition;if(!r)return $("#chatMicrophone").remove(),$("#chatListeningGroup").remove(),void $("#chatListeningAll").prop("checked",!1);const c=new r;c.lang="es-ES",c.continuous=!0,c.interimResults=!1;let l=!1,d="true"===localStorage.getItem("howky-auto");function o(){l||(c.start(),l=!0,$("#chatMicrophone").html('<i class="ic-solar litening_bars"></i>'),console.log("Iniciado reconocimiento de voz.---------------------"))}function a(){l&&(c.stop(),l=!1,$("#chatMicrophone").html('<i class="fa-solid fa-microphone"></i>'),console.log("Detenido reconocimiento de voz.---------------------"))}$("#chatListeningAll").prop("checked",d),$("#chatListeningText").text(d?"Si":"No"),$("#chatMicrophone").on("click",function(){l?a():o()}),$("#chatListeningAll").on("change",function(){const e=$(this).is(":checked");localStorage.setItem("howky-auto",e),e?(o(),$("#chatListeningText").text("Si")):(a(),$("#chatListeningText").text("No")),console.log("##############################"),console.log("###### Auto escucha:",e),console.log("##############################")}),d&&o(),c.onresult=function(e){const t=e.results[e.results.length-1][0].transcript.trim().toLowerCase();console.log("Detectado:",t);const o=["howky","hockey","hawkie","hawking","hauki ","houki","asistente"],a=t.split(" ")[0];if(!o.includes(a))return;const s=t.replace(a,"").trim(),n={abrirMapa:/abre el mapa|muestra el mapa/,cerrarMapa:/cerrar el mapa|cierra el mapa/,iniciarRuta:/como ir|cómo ir|ruta a|como llegar|direcciones|indicaciones|camino a/,borrarRuta:/borrar ruta|eliminar ruta|borra la ruta|borrar la ruta|borrar el camino|borrar el camino/};if(n.abrirMapa.test(s))$("#chatOpenMap").click();else{if(n.cerrarMapa.test(s)){if($("body").hasClass("open_map"))return void $("#chatOpenMap").click()}else{if(n.borrarRuta.test(s))return void $('[data-reset_form="form_route"]').click();n.iniciarRuta.test(s)&&setTimeout(()=>{$("[data-route]").last().click()},2e3)}s&&($("#txtQuestion").text(s),setTimeout(()=>{$("#chatForm").submit(),setTimeout(()=>{$("#txtQuestion").text("")},500)},1e3))}},c.onend=function(){console.log("Reconocimiento finalizado automáticamente.--------");const e="true"===localStorage.getItem("howky-auto");a(),e&&o()},c.onerror=function(e){console.error("Error en reconocimiento:",e.error),d&&"no-speech"===e.error&&a(),d&&"not-allowed"===e.error&&(alertSToast("center",8e3,"error","No se permiten permisos de micrófono. 😥"),$("#chatListeningAll").prop("checked",!1),localStorage.setItem("howky-auto",!1))}}catch(e){console.error("Error Inesperado: ",e),alertSToast("center",8e3,"error","😥 Ha ocurrido un error inesperado. código: #304")}});const contOutput=document.querySelector("#output");let audioEnabled=!0,saludoMostrado=!0;if(contOutput&&saludoMostrado){const e='<div class="chat_msg chat_open" data-tokeid="initialMessage"><div class="msg_response">¡Hola! Soy Hawky 👋😁, tu asistente virtual de la Universidad Tecnológica de Coahuila. Puedes preguntarme sobre trámites, carreras, costos u otros temas de la universidad. ¿En qué puedo ayudarte?😉😊😁</div></div>';contOutput.insertAdjacentHTML("beforeend",e);const t=document.querySelector('.chat_msg[data-tokeid="initialMessage"]');setTimeout(function(){t.classList.add("show")},500)}if(contOutput){const e=new MutationObserver(()=>{scrollToBottom()});scrollToBottom(),e.observe(contOutput,{childList:!0,subtree:!0})}