window.addEventListener("load",()=>{const e=$("#map"),o=localStorage.getItem("mapbox-last_layer"),t=document.querySelectorAll("#offcanvasbody input[type='radio']"),a=document.querySelectorAll("#offcanvasbody label"),i=document.querySelector("#form_route"),r=i.querySelector("#origen"),n=i.querySelector("#destino");let s=!0,l=!1,c="#000";var d;let p,u,m={type:"FeatureCollection",features:[]};const f=document.querySelector("#infoLateral"),g=bootstrap.Offcanvas.getInstance(f)||new bootstrap.Offcanvas(f);mapboxgl.accessToken="pk.eyJ1IjoiY2hhdmEtdXRjIiwiYSI6ImNtOTdqdm13cjA4ZGsyaW9rc2g0OGRmdWoifQ.oxLDSCy8_q3xLJNVtDHmDw";const h=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[-100.93655,25.55701],zoom:17,maxZoom:20,minZoom:15,maxBounds:[[-100.9736,25.5142],[-100.9117,25.5735]]});window.mapMapbox=h;const v=new mapboxgl.GeolocateControl({positionOPtions:{enableHighAccuracy:!0},trackUserLocation:!0,ShowUserHeading:!0,fitBoundsOptions:!1});let b=!1;v.on("geolocate",e=>{if(!b){const o=e.coords.longitude,t=e.coords.latitude;h.setCenter([o,t]),h.setZoom(18),b=!0}}),h.addControl(v),e.hasClass("map_editing")&&(u=new MapboxDraw({displayControlsDefault:!1})),$("#switchTheme").click(function(){$("#switchTheme").is(":checked")?(c="#000",w("streets-v12"),y("streets-v12")):(c="#fff",w("dark-v11"),y("dark-v11"))}),$("#deletePleace").on("hidden.bs.modal",function(e){$(".btnExistPlace").hide(),$("[data-namePleace]").text("")}),h.addControl(new mapboxgl.NavigationControl);function y(e){if(e){a.forEach(e=>e.classList.remove("btn_detail","text-white","cursor-not")),t.forEach(e=>e.removeAttribute("disabled")),t.forEach(e=>e.classList.remove("underline"));document.querySelector(`label[for='${e}']`).classList.add("btn_detail","text-white","cursor-not");const o=document.querySelector(`input#${e}`);o.setAttribute("disabled","disabled"),o.classList.add("underline"),c="#000","dark-v11"===e&&(c="#fff"),localStorage.setItem("mapbox-last_layer",e)}}function w(e){h.setStyle("mapbox://styles/mapbox/"+e)}o&&(y(o),w(o));const C=new MapboxDirections({accessToken:mapboxgl.accessToken,unit:"metric",profile:"mapbox/walking",controls:{inputs:!1,instructions:!1,profileSwitcher:!1},alternatives:!0,interactive:!1});function k(e){h.getCanvas().style.cursor=e}h.addControl(new class{constructor(){this._container=null}onAdd(o){this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl mapboxgl-ctrl-group";const t=(e,o,t,a)=>$("<button>",{class:"mapboxgl-ctrl-"+e,html:o,title:t,type:"button",click:a})[0],a=t("gmaps",'<div class="mapboxgl-ctrl-icon"><i class="fa-solid fa-map-location-dot"></i></div>',"Google Maps",()=>{document.querySelectorAll(".offcanvas.show").forEach(e=>{const o=bootstrap.Offcanvas.getInstance(e);o&&o.hide()}),new mdb.Modal(document.getElementById("beforeSend")).show()}),i=t("gmaps",'<div class="mapboxgl-ctrl-icon"><i class="fa-solid fa-gear"></i></div>',"Configuraciones",()=>{document.querySelectorAll(".offcanvas.show").forEach(e=>{const o=bootstrap.Offcanvas.getInstance(e);o&&o.hide()}),new mdb.Modal(document.getElementById("configModal")).show()}),r=t("styles",'<i class="fa-solid fa-layer-group"></i>',"Cambiar Aspecto",()=>{document.querySelectorAll(".offcanvas.show").forEach(e=>{const o=bootstrap.Offcanvas.getInstance(e);o&&o.hide()});new bootstrap.Offcanvas(document.querySelector("#offcanvasBottom")).show()}),n=t("route",'<div class="mapboxgl-ctrl-icon"><i class="fa-solid fa-route"></i></div>',"Como ir a...",()=>$("#controlsRoute").toggleClass("show"));if(this._container.appendChild(a),this._container.appendChild(r),this._container.appendChild(n),e.hasClass("map_user")&&this._container.appendChild(i),e.hasClass("map_editing")){const e=t("newBuild",'<i class="fa-solid fa-building-flag"></i>',"Crear Nuevo Edificio",()=>{$("#infoLateral").hasClass("show")?g.hide():g.show(),l||L()}),o=t("OSMgo",'<i class="fa-solid fa-book-atlas"></i>',"Editar en OpenStreetMaps",()=>{window.open("https://www.openstreetmap.org/edit#map=17/25.55684/-100.93548","_blank","noopener,noreferrer")}),a=t("importmap",'<div class="mapboxgl-ctrl-icon"><i class="fa-solid fa-cloud-arrow-up"></i></div>',"Importar y Exportar",()=>{new mdb.Modal(document.getElementById("importInMap")).show()});this._container.appendChild(o),this._container.appendChild(a),this._container.appendChild(e)}return this._container}},"top-right"),h.getCanvas().style.cursor="default",h.on("dragstart",()=>k("move")),h.on("dragend",()=>k("default")),h.on("mousedown",()=>k("pointer")),h.on("mouseup",()=>k("default")),h.on("mouseover",()=>k("default")),e.hasClass("map_user")&&h.on("click",function(e){!function(e){d&&d.remove();let o=localStorage.getItem("data-color_rgb");d=new mapboxgl.Marker({color:o||"#3b71ca",draggable:!1}).setLngLat(e).addTo(h)}(e.lngLat)}),t.forEach(e=>{e.addEventListener("click",function(e){const o=e.target.id;y(o),h.getSource("directions")&&(p=h.getSource("directions")._data),w(o)})});const _=document.querySelector("#map").getAttribute("data-mapa_markers");fetch(_).then(e=>e.json()).then(o=>{function t(){o.forEach(e=>{const o=e.nombre.replace(" ","");h.getSource(e.uuid)||h.addSource(e.uuid,{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{uuid:e.uuid,nombre:e.nombre,imagen:e.imagen,ismarker:e.ismarker,icon_size:e.icon_size,sizemarker:e.sizemarker,otheraction:e.otheraction},geometry:{type:"Point",coordinates:e.door}}]}}),h.hasImage(o)||h.loadImage(e.imagen,(t,a)=>{t?console.error("(MAPBOX) Error al cargar imagen:",e.imagen,t):(h.hasImage(o)||h.addImage(o,a),h.getLayer(`points${o}`)||h.addLayer({id:`points${o}`,type:"symbol",source:e.uuid,layout:{"icon-image":o,"icon-size":e.icon_size,"icon-allow-overlap":!0}}))})})}h.loaded()&&t(),h.on("load",()=>{t()}),h.on("style.load",()=>{t()}),h.on("click",t=>{if(s){const a=h.queryRenderedFeatures(t.point,{layers:o.map(e=>`points${e.nombre.replace(" ","")}`)});if(a.length){const o=a[0],{nombre:t,imagen:i,uuid:r,ismarker:n,icon_size:s,otheraction:c}=o.properties;if(e.hasClass("map_user")){const e=m.features.find(e=>e.properties.uuid===c);if(e){const{nombre:o,informacion:t,imagen_url:a,galery_count:i,galery_items:r}=e.properties,n=$("#offcanvasContent"),s=$("#imagen_actual"),c=s.siblings("div");a?(s.attr("src",`/media/${a}`).removeClass("invisible"),c.addClass("mask_white")):(s.addClass("invisible"),c.removeClass("mask_white")),$(".lateralTitle").text(o),n.html(`<div class="feature-info">${t}</div>`),g.show(),l=!0}}else if(e.hasClass("map_editing")){const e=o.geometry.coordinates;E(u.getAll()),$("#imagen_actual").attr("src",i),$(".btnExistPlace").show(),$("[data-namePleace]").text(t),$("#isNewEdif").val("notnew"),$("#coords").val(""),$("#hidename").slideUp(),$("[data-uuid]").addClass("active").val(r),$("#nombreEdificio").addClass("active").val(t),$("#sizemarker").addClass("active").val(s),$("#doorcoords").addClass("active").val(JSON.stringify(e)),$("#fotoEdificio").attr("required",!1),$("#delDoorGroup").removeClass("none"),$("#ismarkerGroup").removeClass("none"),$("#polygonGroup").slideUp("fast"),$("#hideNameGroup").slideUp("fast"),$("#otherAction option").each(function(){$(this).prop("disabled",!1),$(this).val()===t?$(this).prop("disabled",!0):$(this).prop("disabled",!1),otherAction&&$(this).text().trim()===otherAction&&$(this).prop("selected",!0)}),n?($("#checkIsmarker").attr("checked","checked"),$('[data-mdb-target="#flush-oneOption"]').removeClass("collapsed"),$("#flush-oneOption").addClass("show")):($("#checkIsmarker").removeAttr("checked"),$('[data-mdb-target="#flush-oneOption"]').addClass("collapsed"),$("#flush-oneOption").removeClass("show")),$("#checkIsmarker").trigger("change"),$("#coords").removeAttr("required"),$("#submitText").text("Guardar Cambios del Marcador"),O(),g.show(),l=!0,$("#otherAction option").prop("selected",!1),c&&setTimeout(()=>{$(`#otherAction option[value="${c}"]`).prop("selected",!0)},500)}}}})}).catch(e=>{console.error("(MAPBOX) Error al obtener Marcadores del mapa:"),console.error(e),alertSToast("top",5e3,"error","Ocurrio un error inesperado. #403")});const x=document.querySelector("#map").getAttribute("data-mapa_edif");function S(e){let o=e.properties.door;if(o){if("string"==typeof o)try{o=JSON.parse(o)}catch(e){console.error("(MAPBOX) Error al hacer JSON.parse en 'door':",e),o=null}if(Array.isArray(o)&&2===o.length)return o}return function(e){return turf.centroid(e).geometry.coordinates}(e)}function L(){$(".btnExistPlace").hide(),$("[data-namePleace]").text(""),$("#offcanvasContent input").removeClass("active is-invalid is-valid"),$(".error.bg-danger").slideUp("fast"),$("#imagen_actual").attr("src","/static/img/default_image.webp"),$("#nombreEdificio").val(""),$("#offcanvasContent #isNewEdif").val("new"),$("#polygonGroup").slideDown("fast"),$("#hideNameGroup").slideDown("fast"),$("#ismarkerGroup").addClass("none"),$("#tags").val("").click();const e=$("#uuid").data("new-uid");$("#uuid").removeClass("active").val(e),$("#colorPicker").val("#808080"),$("#doorcoords").val(""),$("#coords").val("").attr("required","required"),pickr.setColor("#808080"),$("#fotoEdificio").attr("required",!0),tinymce.get("textTiny").setContent(""),$("[data-notmarker]").slideDown(),$("#hidename").slideDown(),$("#delPoligonGroup").addClass("none"),$("#btnPoligon").html('Dibujar <i class="fa-solid fa-draw-polygon ms-1"></i>').removeClass("bg_purple-anim"),$("#otherAction option").each(function(){$(this).prop("disabled",!1)}),$("#checkIsmarker").removeAttr("checked"),$('[data-mdb-target="#flush-oneOption"]').addClass("collapsed"),$("#flush-oneOption").removeClass("show"),$("#checkIsmarker").trigger("change"),O();E(u.getAll()),$("#delDoorGroup").addClass("none"),$("#submitText").text("Registrar Lugar")}if(fetch(x).then(e=>e.json()).then(o=>{function t(){h.getSource("places")||h.addSource("places",{type:"geojson",data:m}),h.getLayer("places-layer")||h.addLayer({id:"places-layer",type:"fill",source:"places",clickable:!0,paint:{"fill-color":["get","color"],"fill-opacity":["get","opacity"]}}),h.getLayer("places-label")||(h.addLayer({id:"places-label",type:"symbol",source:"places",layout:{"text-field":["get","label"],"text-size":12,"text-offset":[0,-.6],"text-anchor":"top"},paint:{"text-color":c}}),h.moveLayer("places-label"))}function a(){const e=r.value,o=n.value;if(e&&o&&e!==o){const t=m.features.find(o=>o.properties.nombre===e),a=m.features.find(e=>e.properties.nombre===o);if(t&&a){const e=S(t),o=S(a);C.setOrigin(e),C.setDestination(o),$("#buttons_route").slideDown("slow"),C.on("route",e=>{const o={type:"FeatureCollection",features:e.route.map(e=>({type:"Feature",geometry:e.geometry,properties:{}}))};p=o;const t=e.route[0].distance,a=e.route[0].duration;let i;i=t<1e3?`${Math.round(t)} m`:`${(t/1e3).toFixed(2)} km`;const r=Math.floor(a/60),n=Math.round(a%60);let s;s=0===n?`${r} min`:0===r?`${n} s`:`${r}:${n.toString().padStart(2,"0")} min`,$("#route-info").html(`<div class="row">\n                                    <div class="col-1 mb-2">\n                                        <i class="fa-solid fa-shoe-prints me-1"></i>\n                                    </div>\n                                    <div class="col-10 mb-2">\n                                        Distancia: <strong>${i}</strong>\n                                    </div>\n                                \n                                    <div class="col-1">\n                                        <i class="fa-solid fa-hourglass-half me-1"></i>\n                                    </div>\n                                    <div class="col-10">\n                                        Tiempo: <strong>${s} (aprox.)</strong>\n                                    </div>\n                                </div>`),$("#route-info").slideDown()}),window.innerWidth<=800&&setTimeout(()=>{$("#controls_route").removeClass("show")},4e3),h.addControl(C,"top-left"),h.moveLayer("places-label"),i()}}else alertSToast("center",5e3,"warning","Por favor, selecciona tanto origen como destino.")}function i(){if(p&&p.features&&p.features.length>0){h.getSource("directions")||h.addSource("directions",{type:"geojson",data:p});const e=p.features.find(e=>"origin"===e.properties.id),o=p.features.find(e=>"destination"===e.properties.id);h.getLayer("directions-route-line")||h.addLayer({id:"directions-route-line",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2d5f99","line-width":12},filter:["==","$type","LineString"]}),h.getLayer("directions-route-line-alt")||h.addLayer({id:"directions-route-line-alt",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#4882c5","line-width":6},filter:["==","$type","LineString"]}),h.getLayer("directions-origin-point")||h.addLayer({id:"directions-origin-point",type:"circle",source:"directions",paint:{"circle-color":"#3bb2d0","circle-radius":20},filter:["==",["get","id"],"origin"]}),h.getLayer("directions-destination-point")||h.addLayer({id:"directions-destination-point",type:"circle",source:"directions",paint:{"circle-color":"#8a8bc9","circle-radius":20},filter:["==",["get","id"],"destination"]}),h.getLayer("directions-origin-label")||h.addLayer({id:"directions-origin-label",type:"symbol",source:"directions",layout:{"text-field":e.properties["marker-symbol"],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":18},paint:{"text-color":"#fff"},filter:["==",["get","id"],"origin"]}),h.getLayer("directions-destination-label")||h.addLayer({id:"directions-destination-label",type:"symbol",source:"directions",layout:{"text-field":o.properties["marker-symbol"],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":18},paint:{"text-color":"#fff"},filter:["==",["get","id"],"destination"]}),h.moveLayer("places-label")}}m={type:"FeatureCollection",features:o.map(e=>{let o="#808080",t=.4;if(e.color.includes("-"))[o,t]=e.color.split("-"),t=parseFloat(t)||.4;else if(9===e.color.length&&e.color.startsWith("#")){o=e.color.slice(0,7);const a=e.color.slice(7,9);t=parseInt(a,16)/255}return{type:"Feature",properties:{uuid:e.uuid,color:o,opacity:t,label:e.hidename?"":e.nombre,nombre:e.nombre,ismarker:e.ismarker,imagen_url:e.imagen_url,informacion:e.informacion,galery_count:e.galery_count,galery_items:e.galery_items,otheraction:e.otheraction,door:e.door,tags:e.tags},geometry:{type:"Polygon",coordinates:e.coords}}})},h.on("load",function(){t()}),h.on("style.load",function(){t(),i()}),h.on("click","places-layer",o=>{const t=o.features[0],{nombre:a,informacion:i,imagen_url:r,door:n,otherAction:c,galery_count:d,galery_items:p}=t.properties,{coordinates:m}=t.geometry,f=$("#offcanvasContent"),h=$("#imagen_actual"),v=h.siblings("div");if(s){if(r?(h.attr("src",`/media/${r}`).removeClass("invisible"),v.addClass("mask_white")):(h.addClass("invisible"),v.removeClass("mask_white")),e.hasClass("map_user"))$(".lateralTitle").text(a),f.html(`<div class="feature-info">${i}</div>`);else if(e.hasClass("map_editing")){r||(h.attr("src","/static/img/default_image.webp").removeClass("invisible"),v.addClass("mask_white")),$("#offcanvasContent input").removeClass("active is-invalid is-valid"),$(".error.bg-danger").slideUp("fast");const{color:e,uuid:o,label:s,ismarker:l,tags:d}=t.properties;$(".btnExistPlace").show(),$("[data-namePleace]").text(a),$("#isNewEdif").val("notnew"),$("#sizemarker").val("0.5"),$("#colorPicker").val(e),$("#doorcoords").val(n),$("#ismarkerGroup").addClass("none");let p=e,f=.4;e.includes("-")&&([p,f]=e.split("-")),pickr.setColor(`${p}${function(e){const o=Math.round(255*e);return o.toString(16).toUpperCase().padStart(2,"0")}(f)}`),$("[data-uuid]").addClass("active").val(o),$("#nombreEdificio").addClass("active").val(a),$(".name_pleace").text(a);const g=m[0];$("#coords").val(JSON.stringify(g)),$("#fotoEdificio").attr("required",!1),$("#delPoligonGroup").removeClass("none"),$("#btnPoligon").html('Modificar <i class="fa-solid fa-draw-polygon ms-1"></i>'),$("#polygonGroup").slideDown("fast"),$("#hideNameGroup").slideDown("fast"),$("#tags").val(d).click(),""===s?$("#checkHidename").attr("checked","checked"):$("#checkHidename").removeAttr("checked"),l?($("#checkIsmarker").attr("checked","checked"),$('[data-mdb-target="#flush-oneOption"]').removeClass("collapsed"),$("#flush-oneOption").addClass("show")):($("#checkIsmarker").removeAttr("checked"),$('[data-mdb-target="#flush-oneOption"]').addClass("collapsed"),$("#flush-oneOption").removeClass("show")),$("#coords").attr("required","required"),$("#checkIsmarker").trigger("change"),$("#submitText").text("Guardar Cambios del Lugar"),O(),tinymce.get("textTiny").setContent(i),$("#otherAction option").each(function(){$(this).prop("disabled",!1),$(this).val()===a?$(this).prop("disabled",!0):$(this).prop("disabled",!1),c&&$(this).text().trim()===c&&$(this).prop("selected",!0)});E(u.getAll());const b={id:o,type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:m}},[y]=u.add(b);u.changeMode("direct_select",{featureId:y})}g.show(),l=!0}});const d=m.features.map(e=>e.properties).sort((e,o)=>e.nombre.localeCompare(o.nombre));$.each(d,function(o,t){const a=$("<option>").val(t.nombre).text(t.nombre);$("#origen").append(a.clone()),$("#destino").append(a.clone());const i=$("<option>").val(t.uuid).text(t.nombre);e.hasClass("map_editing")&&$("#otherAction").append(i.clone())}),r.addEventListener("change",function(){const e=this.value;n.querySelectorAll("option").forEach(o=>{o.value===e?(o.disabled=!0,o.classList.add("underline")):(o.disabled=!1,o.classList.remove("underline"))});const o=new URLSearchParams(window.location.search);o.set("origin",e),history.replaceState({},"",`${location.pathname}?${o}`),n.value&&a()}),n.addEventListener("change",function(){const e=this.value;n.querySelectorAll("option").forEach(o=>{o.value===e?(o.disabled=!0,o.classList.add("underline")):(o.disabled=!1,o.classList.remove("underline"))});const o=new URLSearchParams(window.location.search);o.set("destiny",e),history.replaceState({},"",`${location.pathname}?${o}`),r.value&&a()});const{origin:f,destiny:v}=function(){const e=new URLSearchParams(window.location.search);return{origin:e.get("origin"),destiny:e.get("destiny")}}();!function(o,t){if(o&&t&&o!==t){$("#controlsRoute").hasClass("show")||$("#controlsRoute").addClass("show"),e.hasClass("map_user")&&$("#chatOpenMap").click();const i=m.features.find(e=>e.properties.nombre===o),s=m.features.find(e=>e.properties.nombre===t);if(i&&s){const e=r.querySelector(`option[value="${o}"]`),i=n.querySelector(`option[value="${t}"]`);e&&(e.selected=!0,r.dispatchEvent(new Event("change"))),setTimeout(()=>{i&&(i.selected=!0,n.dispatchEvent(new Event("change"))),a()},3500)}}}(f,v),$(document).on("click","[data-route]",function(){const e=$(this).attr("data-route").split("~"),o=e[0],t=e[1],i=$("#form_route #origen"),r=$("#form_route #destino");i.find(`option[value="${o}"]`).prop("selected",!0),r.find(`option[value="${t}"]`).prop("selected",!0),i.find(`option[value="${t}"]`).prop("disabled",!0),r.find(`option[value="${o}"]`).prop("disabled",!0),i.trigger("change"),r.trigger("change"),setTimeout(()=>{a()},2e3)})}).catch(e=>{console.error("(MAPBOX) Error al obtener lugares del mapa:"),console.error(e),alertSToast("top",5e3,"error","Ocurrio un error inesperado. #403")}),$("[data-reset_form]").on("click",function(){$("option").each(e=>{e.disabled=!1});["directions-route-line","directions-route-line-alt","directions-route-line-casing","directions-hover-point-casing","directions-hover-point","directions-waypoint-point-casing","directions-waypoint-point","directions-origin-point","directions-origin-label","directions-destination-point","directions-destination-label"].forEach(e=>{h.getLayer(e)&&h.removeLayer(e)}),h.getSource("directions")&&h.removeSource("directions"),$("#buttons_route").slideUp("slow"),$("#route-info").slideUp("slow",()=>{$("#route-info").empty()});const e=new URLSearchParams(window.location.search);e.delete("origin"),e.delete("destiny");const o=e.toString()?`${location.pathname}?${e.toString()}`:location.pathname;history.replaceState({},"",o)}),e.hasClass("map_editing")){function E(e){e.features.length>0&&e.features.forEach(e=>{u.delete(e.id)})}function A(e){const o=u.getAll();if($("#controlsIndic").removeClass("show"),$("#delPoligonGroup").removeClass("none"),$("#btnPoligon").html('Modificar <i class="fa-solid fa-draw-polygon ms-1"></i>').removeClass("bg_purple-anim").addClass("btn_detail"),o.features.length>0){const e=o.features[0].geometry.coordinates[0];$("#coords").val(JSON.stringify(e)),s=!0}else $("#controlsIndic").removeClass("show"),"draw.delete"!==e.type&&alertSToast("center",8e3,"error","Haz clic en el mapa para dibujar un pol√≠gono.")}h.addControl(u),h.on("draw.create",A),h.on("draw.delete",A),h.on("draw.update",A),$("#btnPoligon").click(function(){s=!1;E(u.getAll()),$("#controlsIndic").addClass("show"),$("#delPoligonGroup").addClass("none"),$(this).html('Dibujando... <i class="fa-solid fa-draw-polygon ms-1"></i>').addClass("bg_purple-anim").removeClass("btn_detail"),u.changeMode("draw_polygon")}),$("#delPoligon").click(function(){s=!0,$("#controlsIndic").removeClass("show"),$("#delPoligonGroup").addClass("none"),$("#coords").val(""),$("#btnPoligon").html('Dibujar <i class="fa-solid fa-draw-polygon ms-1"></i>').removeClass("bg_purple-anim").addClass("btn_detail");E(u.getAll())});let P=null,I=!1;function O(){setTimeout(()=>{$("#checkIsmarker").is(":checked")?($("#setDoor").html('Ubicacion <i class="fas fa-location-dot ms-1"></i>'),$("#delDoor").text("Eliminar ubicacion"),$("#coords").removeAttr("required","required"),$("#textTinyGroup").slideUp("fast")):($("#setDoor").html('Definir Punto de Entrada <i class="fas fa-door-open ms-1"></i>'),$("#delDoor").text("Eliminar Punto de Entrada"),$("#coords").attr("required","required"),$("#textTinyGroup").slideDown("fast"))},500)}$("#delDoor").on("click",function(){$("#doorcoords").val(""),$("#delDoorGroup").addClass("none"),$("#setDoor").removeClass("bg_purple-anim").addClass("bg_purple"),O(),P&&(P.remove(),P=null)}),$("#setDoor").on("click",function(){I?(I=!1,s=!0,P&&(P.remove(),P=null),$("#doorcoords").val(""),$("#delDoorGroup").addClass("none"),$(this).removeClass("bg_purple-anim").addClass("bg_purple"),O()):(I=!0,s=!1,$(this).removeClass("bg_purple").addClass("bg_purple-anim").text("Coloca el punto..."),$("#delDoorGroup").addClass("none"),P&&(P.remove(),P=null),h.once("click",function(e){const o=e.lngLat;P=new mapboxgl.Marker({color:"#ae37cc"}).setLngLat([o.lng,o.lat]).addTo(h),$("#doorcoords").val(JSON.stringify([o.lng,o.lat])),$("#setDoor").removeClass("bg_purple-anim").addClass("bg_purple"),O(),$("#delDoorGroup").removeClass("none"),I=!1,s=!0}))}),$("#checkIsmarker").on("change",function(){O();$("#checkIsmarker").is(":checked")?$("#submitText").text("Guardar cambios del Marcador"):$("#submitText").text("Guardar cambios del Lugar")}),$("#newPlace").on("click",L)}});