$(document).ready(function(){const a=$("#asistent_model"),e=a.attr("animation-name");let t,n,i;a.on("load",()=>t=a[0].availableAnimations);const r=$("#cameraHorizontal"),o=$("#cameraVertical"),s=$("#cameraDistance");function l(){const e=r.val(),t=o.val(),n=s.val();e&&t&&n&&a.attr("camera-orbit",`${e}deg ${t}deg ${n}m`)}r.on("input",l),o.on("input",l),s.on("input",l),l(),listHDRIs=["rainforest_trail_1k","symmetrical_garden_02_1k","rogland_clear_night_1k",""],currentIndex=0,$("#changeScene").click(function(){localStorage.setItem("model_hdr",listHDRIs[currentIndex]),""==listHDRIs[currentIndex]?(a.attr("environment-image",""),a.attr("skybox-image","")):(a.attr("environment-image",`/media/hdri/${listHDRIs[currentIndex]}.hdr`),a.attr("skybox-image",`/media/hdri/${listHDRIs[currentIndex]}.hdr`)),currentIndex++,currentIndex>=listHDRIs.length&&(currentIndex=0)});const c=localStorage.getItem("model_hdr");c&&(a.attr("environment-image",`/media/hdri/${c}.hdr`),a.attr("skybox-image",`/media/hdri/${c}.hdr`));const d=$("#pauseAnim");let m=!1;d.on("click",function(){m=!m,m?a[0].pause():a[0].play(),d.attr("title",m?"Activar Animaci√≥n":"Pausar Animaci√≥n").html(m?'<i class="fa-solid fa-circle-play fs-20"></i>':'<i class="fa-regular fa-circle-pause fs-20"></i>')});const u=$("#reloadModel"),p=$("#model_areas"),f=$("#areasAnimations"),g=$("#animationsSelect");let h=0;function v(n){a.attr("src","/static/img/howki-final.glb"),setTimeout(()=>{a.attr("src",n)},100),a.on("load",function(){h=t.length,$("#num_areas").attr("max",h),g.empty(),h>0?($.each(t,function(a,e){g.append($("<option>",{value:e,text:e}))}),e&&$(`#animationsSelect option[value="${e}"]`).attr("selected",!0),$("#modelAreasCont").slideDown()):($("#modelAreasCont").slideUp(),0==h&&g.append("<option hidden selected disabled>No hay animaciones</option>")),m=!1,a[0].play(),d.attr("title","Pausar Animacion").html('<i class="fa-regular fa-circle-pause fs-20"></i>')})}function b(r){const o=parseInt(r,10);if(null!=o||""!=o||0!=o){p.empty(),f.empty();for(let a=1;a<=o;a++)f.append(`<div class="col-12"><fieldset class="p-2" id="sectionAnim${a}"><legend class="px-2 mb-0">Boton #${a}:</legend><select class="form-select animationsSelect selectList" data-add-action="#actionAnim${a}" name="areaAnim"><option selected hidden disabled>Animacion:</option></select><div class="row mt-4"><div class="col-4 col-md-4 mb-4 mb-md-0"><div data-mdb-input-init class="form-outline"><input type="number" id="areaTime${a}" data-anim-btn="#actionAnim${a}" name="areaTime" max="10" min="1" value="2" class="form-control text-end" /><label class="form-label" for="areaTime${a}">Duracion: (s)</label></div></div><div class="col-4 col-md-4"><div data-mdb-input-init class="form-outline"><input type="number" id="areaHeight${a}" data-anim-btn="#actionAnim${a}" name="areaHeight" min="1" max="${i}" value="1" class="form-control text-end" /><label class="form-label" for="areaHeight${a}">Alto:</label></div></div><div class="col-4 col-md-4"><div data-mdb-input-init class="form-outline"><input type="number" id="areaWidth${a}" data-anim-btn="#actionAnim${a}" name="areaWidth" min="1" max="${n}" value="1" class="form-control text-end" /><label class="form-label" for="areaWidth${a}">Largo:</label></div></div></div></fieldset></div>`),p.append(`<button type="button" id="actionAnim${a}" class="item play-anim-btn d-flex justify-content-center align-items-center fs-20" disabled>${a}</button>`),$("[data-mdb-input-init]").each(function(){new mdb.Input(this)});$(".animationsSelect").on("change",function(){const a=$(this).attr("data-add-action"),e=$(this).val();$(a).attr("data-animation",e),$(a).removeAttr("disabled")}),$('input[name="areaHeight"]').on("input",function(){if($("#modelAreas").is(":checked")){const a=parseInt($(this).val(),10),e=$(this).attr("data-anim-btn");$(e).removeClass(function(a,e){return(e.match(/(^|\s)grid-row_span\S+/g)||[]).join(" ")}),$(e).addClass(`grid-row_span-${a}`)}}),$('input[name="areaWidth"]').on("input",function(){if($("#modelAreas").is(":checked")){const a=parseInt($(this).val(),10),e=$(this).attr("data-anim-btn");$(e).removeClass(function(a,e){return(e.match(/(^|\s)grid-col_span\S+/g)||[]).join(" ")}),$(e).addClass(`grid-col_span-${a}`)}}),$(".play-anim-btn").click(function(){!function(t,n=2){clearTimeout(window.animTimer),a[0].animationName=t,a[0].play(),window.animTimer=setTimeout(()=>{const t=$("#animationsSelect").val();a[0].animationName=t||e,a[0].play(),m=!1,d.attr("title","Pausar Animacion").html('<i class="fa-regular fa-circle-pause fs-20"></i>')},1e3*n)}($(this).attr("data-animation"),$(this).attr("data-duration"))}),function(){const a=$(".animationsSelect.selectList");a.empty(),h>1?(a.append("<option hidden selected disabled>Animaciones:</option>"),$.each(t,function(e,t){a.append($("<option>",{value:t,text:t}))})):($("#modelAreasCont").slideUp(),0==h&&a.append("<option hidden selected disabled>No hay animaciones</option>"))}()}}function A(a=3,e=3){i=$("#row_areas").val(),n=$("#col_areas").val(),$("#model_areas").css({"--grid-row":i||a,"--grid-column":n||e})}$("#fileInput").on("change",function(a){const e=a.target.files[0];if(e){const a=["glb","gltf"],t=e.name.split(".").pop().toLowerCase();if(!a.includes(t))return alertSToast("center",8e3,"error","Por favor proporciona un archivo tipo GLB o GLTF");v(URL.createObjectURL(e))}}),u.on("click",function(){const a=$.trim($(this).data("model"));a&&v(a)}),$("#animationsSelect").on("change",function(){const e=$(this).val();e&&(a[0].animationName=e,m=!1,a[0].play(),d.attr("title","Pausar Animacion").html('<i class="fa-regular fa-circle-pause fs-20"></i>'))}),$("#num_areas").on("input",function(){const a=$("#num_areas").val();$("#modelAreas").is(":checked")&&b(a)}),$("#row_areas, #col_areas").on("input",A),$("#hawkySettings").length&&function(){const e=a.attr("data-settings-model"),t=new FormData;t.append("idSetings","2"),fetch(e,{method:"POST",body:t,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRFToken":formToken}}).then(a=>a.json()).then(e=>{0!=e.success?($("[data-range-val='#cameraHorizontal']").text(e.cameraOrbit[0]),$("[data-range-val='#cameraVertical']").text(e.cameraOrbit[1]),$("[data-range-val='#cameraDistance']").text(e.cameraOrbit[2]),$("#cameraHorizontal").attr("value",e.cameraOrbit[0]),$("#cameraVertical").attr("value",e.cameraOrbit[1]),$("#cameraDistance").attr("value",e.cameraOrbit[2]),a.attr("camera-orbit",`${e.cameraOrbit[0]}deg ${e.cameraOrbit[1]}deg ${e.cameraOrbit[2]}m`),e.gridAreas&&($("#num_areas").attr("value",e.gridAreas[0]),$("#row_areas").attr("value",e.gridAreas[1]),$("#col_areas").attr("value",e.gridAreas[2]),A(e.gridAreas[1],e.gridAreas[2])),setTimeout(()=>{e.gridAreas&&b(e.gridAreas[0]),setTimeout(()=>{!function(){if(e.animations){const a=e.animations;for(let e=0;e<a[0].length;e++){const t=a[0][e];$(`#sectionAnim${e+1} option[value="${t}"]`).attr("selected",!0),$(`#actionAnim${e+1}`).removeAttr("disabled").attr({"data-animation":t,"data-duration":a[1][e]}).addClass(`grid-row_span-${a[2][e]} grid-col_span-${a[3][e]}`),$(`#sectionAnim${e+1} #areaTime${e+1}`).attr("value",a[1][e]),$(`#sectionAnim${e+1} #areaHeight${e+1}`).attr("value",a[2][e]),$(`#sectionAnim${e+1} #areaWidth${e+1}`).attr("value",a[3][e])}}}()},500)},1e3)):alertSToast("center",5e3,"warning",e.message)}).catch(a=>{console.error("üò• Error inesperado:",a),errorMessage=a.message||"Ocurri√≥ un error. Intente nuevamente. üò•",alertSToast("center",13e3,"error",errorMessage)})}(),setTimeout(()=>{if(u.click(),$("#modelAreas").is(":checked")){var a=$("#modelAreas").data("btn_closed");$(a).toggleClass("show"),a.includes("slide")&&$(a).slideToggle("slow")}},500)});